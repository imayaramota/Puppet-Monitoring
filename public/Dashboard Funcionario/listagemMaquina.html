<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Máquina Virtual/ Admin Dashboard </title>
    <link rel="stylesheet"
        href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
    <link rel="stylesheet" href="./style/listagemMaquina.css">
    <link rel="icon" href="./assets/LogoRoxo.png">
</head>

<body>
    <!--Menu Lateral-->
    <input type="checkbox" id="nav-toggle">
    <div class="barraLateral">
        <div class="barraLateralLogo">
            <h2><span>PUPPET</span></h2>
        </div>
        <div class="barraLateralMenu">
            <ul>
                <li class="list active">
                    <a href="./listagemMaquina.html">
                        <span class="las la-server"></span>
                        <span>Máquinas virtuais</span>
                    </a>
                </li>
                <li class="list">
                    <a href="#">
                        <span class="las la-cog"></span>
                        <span>Configurações</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <!--Header-->
    <div class="mainContent">
        <header>
            <h2>
                <label for="nav-toggle">
                    <span class="las la-bars"></span>
                </label>
                Máquinas Virtuais
            </h2>
            <div class="usuario">
                <img src="./assets/whindUsuario.jpg" width="40px" height="40px" alt="">
                <div>
                    <h3><span id="b_usuario"></span></h3>
                    <small id="setor_usuario"></small>
                </div>
            </div>
        </header>
        <!--Listagem de Máquinas-->
        <main>
            <div class="listagemUsu">
                <div class="listagem">
                    <div>
                        <div class="cardHeader">
                            <button class="btnCadastrar"><a href="#">Cadastrar</a></button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="listagemMaquina" class="cards"></div>
        </main>
        <script src="../plugins/sweetalert2-11.4.8/package/dist/sweetalert2.min.js"></script>
        <link rel="stylesheet" href="../plugins/sweetalert2-11.4.8/package/dist/sweetalert2.min.css">
        <script>
             3

            fetch("http://localhost:3333/maquinas", {
                method: "GET",
            }).then(function (resposta) {
                resposta.json().then(json => {
                    listar_maq(json)
                });

            }).catch(function (erro) {
                console.log(erro);
            })

            function listar_maq(maquinas) {
                let tbody = '';

                // estrutura de repetição que não necessita de um break
                maquinas.forEach(function (maquina) {
                    tbody += `
                    <div class="cardSingle">
                        <h1>${[maquina.nome]}</h1>
                     </div>
                    `;
                });

                listagemMaquina.innerHTML = tbody;
            }

            // para onde você quer que redirecione
            function editar_maquina(id) {
                window.location = "painel_cadastro.html?id=" + id
            } // depois da ? é um parâmetro

            function excluir_maquina(id) {
                Swal.fire({
                    title: 'Você tem certeza?',
                    text: "Esta ação não poderá ser desfeita!",
                    icon: 'Atenção',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Sim, deletar!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        fetch("http://localhost:3333/maquinas/deletar/" + id, {
                            method: "DELETE", // deletar
                        }).then(function (resposta) {
                            resposta.json().then(json => {
                                fetch("http://localhost:3333/maquinas", {
                                    method: "GET",
                                }).then(function (resposta) {
                                    if (resposta.status == 200) {
                                        resposta.json().then(json => {
                                            listar_usu(json)
                                            Swal.fire(
                                                'Deletado!',
                                                'Seu arquivo foi deletado',
                                                'sucesso'
                                            )
                                        });
                                    } else {
                                        listagemMaquina.innerHTML = '';
                                    }
                                }).catch(function (erro) {
                                    console.log(erro);
                                })

                            });

                        }).catch(function (erro) {
                            console.log(erro);
                        })
                    }
                })

            }
        </script>
</body>

</html>